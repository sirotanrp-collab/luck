/* ===== ラッキー・ロト・ライフ - ゆるいドット絵テイスト ===== */
:root {
  --pastel-bg: #fef6e8;
  --pastel-panel: #f5e6d3;
  --pastel-border: #e8d4bc;
  --pastel-accent: #c9b896;
  --pastel-green: #b8e0b8;
  --pastel-pink: #f5d5d5;
  --pastel-blue: #d5e5f5;
  --pastel-yellow: #f5f0d5;
  --text-dark: #5c5346;
  --shadow-soft: rgba(92, 83, 70, 0.15);
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  min-height: 100vh;
  font-family: "DotGothic16", sans-serif;
  background: var(--pastel-bg);
  color: var(--text-dark);
  display: flex;
  justify-content: center;
  align-items: center;
  image-rendering: pixelated;
  image-rendering: -moz-crisp-edges;
  image-rendering: crisp-edges;
}

/* スマホ縦長（平均的な縦長） */
.game-container {
  width: 100%;
  max-width: 390px;
  min-height: 700px;
  height: 100vh;
  max-height: 844px;
  background: var(--pastel-panel);
  border: 4px solid var(--pastel-border);
  border-radius: 8px;
  box-shadow: 0 8px 0 var(--pastel-accent), 0 10px 20px var(--shadow-soft);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* ----- 上部：ステータスバー ----- */
.status-bar {
  display: flex;
  justify-content: space-around;
  align-items: center;
  padding: 12px 8px;
  background: var(--pastel-yellow);
  border-bottom: 4px solid var(--pastel-border);
  font-size: 0.95rem;
}

.status-item {
  padding: 4px 8px;
  background: var(--pastel-bg);
  border: 2px solid var(--pastel-border);
  border-radius: 4px;
}

/* ----- 中央：メインウィンドウ（部屋を広く） ----- */
.main-window {
  flex: 1;
  padding: 12px 16px;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

.message-frame {
  width: 100%;
  flex: 1;
  min-height: 320px;
  background: var(--pastel-bg);
  border: 4px solid var(--pastel-border);
  border-radius: 8px;
  padding: 12px;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: 10px;
  box-shadow: inset 0 2px 4px var(--shadow-soft);
}

/* ----- 家の中（部屋・広め） ----- */
.room {
  position: relative;
  width: 100%;
  flex: 1;
  min-height: 280px;
  border-radius: 6px;
  overflow: hidden;
  border: 3px solid var(--pastel-border);
}

.room-wall {
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, #e8dfd0 0%, #ddd4c5 100%);
}

.room-floor {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  height: 42%;
  background: repeating-linear-gradient(
    90deg,
    #c4a574 0px,
    #c4a574 10px,
    #b8956a 10px,
    #b8956a 20px
  );
}

.room-window {
  position: absolute;
  top: 16px;
  right: 20px;
  width: 40px;
  height: 36px;
  background: var(--pastel-blue);
  border: 3px solid var(--pastel-border);
  border-radius: 2px;
  box-shadow: inset 0 0 0 2px rgba(255,255,255,0.5);
  z-index: 1;
}

/* 家具配置スロット（2行×3列） */
.room-slots {
  position: absolute;
  inset: 0;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  z-index: 1;
  pointer-events: none;
}

.room-slot {
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: auto;
  min-height: 0;
}

.room-slot-placeholder {
  width: 56px;
  height: 56px;
  border: 2px dashed var(--pastel-border);
  border-radius: 4px;
  background: rgba(255,255,255,0.1);
  display: flex;
  align-items: center;
  justify-content: center;
}

.room-slot.has-furniture .room-slot-placeholder {
  border-style: solid;
  background: transparent;
}

.room-slot .furniture-sprite-wrap {
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  image-rendering: pixelated;
}

.furniture-sprite-wrap .furniture-grid {
  display: grid;
}

.room-slot .furniture-sprite-wrap .furniture-grid {
  width: 24px;
  height: 24px;
}

.room-slot .furniture-sprite-wrap .furniture-grid .fp {
  width: 2px;
  height: 2px;
}

/* 配置モーダル用スロット（クリック可能） */
.place-modal .room-slot {
  cursor: pointer;
}

.place-modal .room-slot:hover .room-slot-placeholder {
  background: rgba(200,230,200,0.4);
}

.place-modal .room-slot.occupied .room-slot-placeholder {
  background: rgba(255,200,200,0.2);
}

.modal-place .place-slots-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(2, 1fr);
  gap: 12px;
  margin-bottom: 16px;
  min-height: 140px;
}

.modal-place .place-slots-grid .room-slot {
  min-width: 0;
}

.modal-place .place-slots-grid .room-slot-placeholder {
  width: 100%;
  height: 64px;
  font-size: 0.8rem;
  color: var(--pastel-accent);
}

/* ----- 主人公ドット絵（8x12） ----- */
.hero {
  position: absolute;
  width: 32px;
  height: 48px;
  left: 24px;
  bottom: 52px;
  transition: left 0.4s linear, bottom 0.4s linear;
  z-index: 2;
}

.hero.walking {
  animation: hero-bob 0.25s ease-in-out infinite;
}

@keyframes hero-bob {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-2px); }
}

.hero-sprite {
  display: grid;
  grid-template-columns: repeat(8, 4px);
  grid-template-rows: repeat(12, 4px);
  width: 32px;
  height: 48px;
  image-rendering: pixelated;
}

.hero-sprite .p {
  width: 4px;
  height: 4px;
  display: block;
}

.hero-sprite .p-x { background: transparent; } /* 透明 */
.hero-sprite .p-h { background: #5c4a3a; }   /* 髪 */
.hero-sprite .p-s { background: #f4d3a6; }   /* 顔 */
.hero-sprite .p-t { background: #6b8e9e; }   /* 服 */
.hero-sprite .p-l { background: #4a6b7c; }   /* 足 */

.situation-message {
  margin: 0;
  font-size: 0.9rem;
  line-height: 1.5;
  text-align: center;
  min-height: 2.5em;
}

/* ----- 下部：操作バー ----- */
.action-bar {
  display: flex;
  gap: 12px;
  padding: 12px 16px;
  background: var(--pastel-green);
  border-top: 4px solid var(--pastel-border);
}

.action-bar-sub {
  border-top: 2px solid var(--pastel-border);
  padding-top: 8px;
  padding-bottom: 16px;
}

.action-bar-sub .btn {
  flex: 1;
}

.btn {
  flex: 1;
  font-family: "DotGothic16", sans-serif;
  font-size: 1rem;
  padding: 12px 8px;
  border: 3px solid var(--pastel-border);
  border-radius: 6px;
  background: var(--pastel-bg);
  color: var(--text-dark);
  cursor: pointer;
  transition: transform 0.1s ease, box-shadow 0.1s ease;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 0 var(--pastel-accent);
}

.btn:active {
  transform: translateY(0);
  box-shadow: 0 2px 0 var(--pastel-accent);
}

.btn-training {
  background: var(--pastel-yellow);
}

.btn-lottery {
  background: var(--pastel-pink);
}

.btn-shop {
  background: var(--pastel-blue);
}

.btn-inventory {
  background: var(--pastel-yellow);
}

/* ----- モーダル：買い物・所持アイテム ----- */
.modal-shop .shop-list,
.modal-inventory .inventory-list {
  margin-bottom: 12px;
  max-height: 280px;
  overflow-y: auto;
}

.shop-row {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 8px;
  padding: 8px 0;
  border-bottom: 1px solid var(--pastel-border);
  font-size: 0.9rem;
}

.shop-row .shop-item-name {
  min-width: 100px;
}

.shop-row .shop-item-price {
  color: var(--text-dark);
}

.shop-row .shop-item-bonus {
  color: #2d7a3e;
  font-weight: bold;
}

.shop-row .shop-owned {
  margin-left: auto;
  font-size: 0.8rem;
  color: var(--pastel-accent);
}

.shop-row .btn-buy {
  margin-left: auto;
  flex: 0 0 auto;
  padding: 6px 12px;
  font-size: 0.9rem;
}

.shop-row .shop-item-preview {
  width: 32px;
  height: 32px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.shop-row .shop-item-preview .furniture-grid .fp {
  width: 2px;
  height: 2px;
}

.inventory-row {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 0;
  border-bottom: 1px solid var(--pastel-border);
  font-size: 0.9rem;
}

.inventory-row .inv-preview {
  width: 28px;
  height: 28px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.inventory-row .inv-preview .furniture-grid .fp {
  width: 2px;
  height: 2px;
}

.inventory-row .inv-info {
  flex: 1;
}

.inventory-row .inv-actions {
  display: flex;
  gap: 6px;
}

.inventory-row .btn-place,
.inventory-row .btn-store {
  padding: 4px 10px;
  font-size: 0.8rem;
}

.inventory-empty {
  margin: 0;
  padding: 12px 0;
  color: var(--pastel-accent);
  text-align: center;
}

.inventory-total {
  margin: 0 0 12px;
  padding: 8px;
  background: var(--pastel-yellow);
  border-radius: 4px;
  font-weight: bold;
  text-align: center;
}

/* ----- モーダル：枚数選択 ----- */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(92, 83, 70, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s ease, visibility 0.2s ease;
}

.modal-overlay.is-open {
  opacity: 1;
  visibility: visible;
}

/* ----- 抽選中オーバーレイ ----- */
.drawing-overlay {
  position: fixed;
  inset: 0;
  background: rgba(92, 83, 70, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 150;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.25s ease, visibility 0.25s ease;
}

.drawing-overlay.is-open {
  opacity: 1;
  visibility: visible;
}

.drawing-content {
  text-align: center;
  padding: 24px 32px;
  background: var(--pastel-panel);
  border: 4px solid var(--pastel-border);
  border-radius: 8px;
  box-shadow: 0 8px 0 var(--pastel-accent), 0 12px 24px var(--shadow-soft);
}

.drawing-text {
  margin: 0 0 12px;
  font-size: 1.1rem;
}

.drawing-dots {
  display: flex;
  justify-content: center;
  gap: 4px;
  font-size: 1.2rem;
}

.drawing-dots .dot {
  opacity: 0.4;
}

.drawing-overlay.is-open .drawing-dots .dot {
  animation: dot-pulse 0.6s ease-in-out infinite both;
}

.drawing-overlay.is-open .drawing-dots .dot:nth-child(2) { animation-delay: 0.2s; }
.drawing-overlay.is-open .drawing-dots .dot:nth-child(3) { animation-delay: 0.4s; }

@keyframes dot-pulse {
  0%, 100% { opacity: 0.3; transform: scale(0.9); }
  50% { opacity: 1; transform: scale(1.2); }
}

.modal-content {
  width: 90%;
  max-width: 360px;
  background: var(--pastel-panel);
  border: 4px solid var(--pastel-border);
  border-radius: 8px;
  padding: 20px;
  box-shadow: 0 8px 0 var(--pastel-accent), 0 12px 24px var(--shadow-soft);
}

.modal-title {
  margin: 0 0 16px;
  font-size: 1.1rem;
  text-align: center;
}

.ticket-options {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-bottom: 16px;
}

.ticket-btn {
  font-family: "DotGothic16", sans-serif;
  font-size: 1rem;
  padding: 12px;
  border: 3px solid var(--pastel-border);
  border-radius: 6px;
  background: var(--pastel-bg);
  color: var(--text-dark);
  cursor: pointer;
  transition: background 0.15s ease, transform 0.1s ease;
}

.ticket-btn:hover {
  background: var(--pastel-blue);
  transform: scale(1.02);
}

.ticket-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.btn-back {
  width: 100%;
}

/* ----- モーダル：当選結果 ----- */
.modal-result .result-summary {
  font-size: 1rem;
  font-weight: bold;
  text-align: center;
  margin-bottom: 12px;
  padding: 8px;
  background: var(--pastel-yellow);
  border-radius: 4px;
}

.modal-result .result-details {
  font-size: 0.85rem;
  margin-bottom: 16px;
  max-height: 200px;
  overflow-y: auto;
}

.result-details .grade-row {
  display: flex;
  justify-content: space-between;
  padding: 4px 0;
  border-bottom: 1px solid var(--pastel-border);
}

.btn-close-result {
  width: 100%;
}

/* ----- 画面切り替え ----- */
.hidden {
  display: none !important;
}

/* ----- 競馬予想画面 ----- */
.race-window {
  padding: 12px;
  max-height: 90vh;
  overflow-y: auto;
}

.race-frame {
  width: 100%;
  min-height: 280px;
  background: var(--pastel-bg);
  border: 4px solid var(--pastel-border);
  border-radius: 8px;
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  box-shadow: inset 0 2px 4px var(--shadow-soft);
}

.race-title {
  margin: 0;
  font-size: 1rem;
  text-align: center;
}

.race-table-wrap {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  border: 3px solid var(--pastel-border);
  border-radius: 4px;
  background: var(--pastel-yellow);
}

.race-table {
  width: 100%;
  min-width: 520px;
  border-collapse: collapse;
  font-size: 0.75rem;
}

.race-table th,
.race-table td {
  padding: 6px 8px;
  border: 2px solid var(--pastel-border);
  white-space: nowrap;
}

.race-table th {
  background: var(--pastel-panel);
}

.race-table .frame-cell {
  font-weight: bold;
  text-align: center;
}

.race-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: center;
}

.race-actions .btn {
  flex: 0 0 auto;
}

.btn-race {
  background: var(--pastel-blue);
}

.btn-ticket {
  background: var(--pastel-pink);
}

.btn-start {
  background: var(--pastel-green);
}

/* ----- 馬券購入モーダル ----- */
.modal-ticket {
  max-width: 380px;
}

.ticket-tabs {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-bottom: 12px;
}

.ticket-tab {
  font-family: "DotGothic16", sans-serif;
  font-size: 0.8rem;
  padding: 6px 10px;
  border: 2px solid var(--pastel-border);
  border-radius: 4px;
  background: var(--pastel-bg);
  color: var(--text-dark);
  cursor: pointer;
}

.ticket-tab.active {
  background: var(--pastel-blue);
  border-color: var(--text-dark);
}

.ticket-formation {
  display: flex;
  gap: 12px;
  margin-bottom: 12px;
  justify-content: center;
}

.ticket-place-col {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 8px;
  border: 3px solid var(--pastel-border);
  border-radius: 6px;
  background: var(--pastel-yellow);
  min-width: 72px;
}

.place-col-title {
  font-size: 0.85rem;
  font-weight: bold;
  margin-bottom: 4px;
}

.place-num-btn,
.place-all-btn {
  font-family: "DotGothic16", sans-serif;
  width: 28px;
  height: 28px;
  padding: 0;
  border: 2px solid var(--pastel-border);
  border-radius: 4px;
  background: var(--pastel-bg);
  cursor: pointer;
  font-size: 0.85rem;
}

.place-num-btn.selected {
  background: var(--pastel-blue);
  border-color: var(--text-dark);
}

.place-all-btn {
  width: 100%;
  margin-top: 4px;
  font-size: 0.75rem;
}

.ticket-yen-per-point {
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

.ticket-yen-per-point label { font-size: 0.9rem; }
.ticket-yen-per-point input {
  width: 80px;
  font-family: "DotGothic16", sans-serif;
  font-size: 1rem;
  padding: 4px 8px;
  border: 2px solid var(--pastel-border);
  border-radius: 4px;
}

.ticket-summary {
  margin: 0 0 12px;
  text-align: center;
  font-size: 0.9rem;
}

.modal-ticket .btn-primary {
  margin-bottom: 8px;
}

/* ----- 競馬結果モーダル ----- */
.modal-result-race {
  max-width: 400px;
  max-height: 90vh;
  overflow-y: auto;
}

.race-result-table-wrap {
  overflow-x: auto;
  margin-bottom: 12px;
  border: 3px solid var(--pastel-border);
  border-radius: 4px;
}

.race-result-table {
  width: 100%;
  min-width: 320px;
  border-collapse: collapse;
  font-size: 0.75rem;
}

.race-result-table th,
.race-result-table td {
  padding: 6px 4px;
  border: 2px solid var(--pastel-border);
  vertical-align: middle;
}

.race-result-table thead th {
  background: #7a7268;
  color: #fff;
  text-align: center;
}

.race-result-table tbody tr:nth-child(even) {
  background: rgba(255,255,255,0.5);
}

.result-chakujun .chakujun-suffix { font-size: 0.7em; vertical-align: super; }
.result-frame, .result-baban { text-align: center; font-weight: bold; }
.result-name { display: flex; flex-direction: column; }
.result-name .horse-name { font-weight: bold; }
.result-name .jockey-name { font-size: 0.85em; color: var(--pastel-accent); }
.result-time { text-align: center; white-space: nowrap; }
.result-time .time-main { display: block; }
.result-time .time-margin { font-size: 0.9em; }
.result-time .time-agari { font-size: 0.85em; color: var(--pastel-accent); }
.result-odds { text-align: right; }
.result-odds .odds-val { display: block; }
.result-odds .odds-ninki { font-size: 0.85em; color: var(--pastel-accent); }

.payout-title {
  margin: 0 0 8px;
  font-size: 1rem;
}

.payout-table-wrap {
  overflow-x: auto;
  margin-bottom: 12px;
  border: 2px solid var(--pastel-border);
  border-radius: 4px;
}

.payout-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.8rem;
}

.payout-table td {
  padding: 6px 8px;
  border: 1px solid var(--pastel-border);
}

.payout-type {
  font-weight: bold;
  width: 72px;
  text-align: left;
  vertical-align: middle;
}

.payout-tansho { background: #4a5568; color: #fff; }
.payout-fukusho { background: #c53030; color: #fff; }
.payout-umaren { background: #553c9a; color: #fff; }
.payout-wide { background: #2c7a7b; color: #fff; }
.payout-umatan { background: #c05621; color: #fff; }
.payout-sanrenpuku { background: #2b6cb0; color: #fff; }
.payout-sanrentan { background: #dd6b20; color: #fff; }

.payout-combi { text-align: right; }
.payout-yen { text-align: right; font-weight: bold; }
.payout-ninki { text-align: right; font-size: 0.9em; color: var(--pastel-accent); }

.race-result-total-payout {
  margin: 0 0 12px;
  text-align: center;
  font-weight: bold;
  font-size: 1rem;
}

/* ----- レースアニメーション ----- */
.race-anim-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.92);
  z-index: 200;
  display: none;
  justify-content: center;
  align-items: center;
  padding: 8px;
}
.race-anim-overlay[aria-hidden="false"] { display: flex; }

.race-anim-content {
  width: 100%;
  max-width: 480px;
  background: #0d2818;
  border: 3px solid #c9b896;
  border-radius: 8px;
  padding: 8px 8px 10px;
  color: #fff;
}

/* 情報バー */
.race-anim-info {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  margin-bottom: 6px;
  padding: 0 4px;
}
.race-anim-header { font-size: 0.75rem; color: #c9b896; }
.race-anim-phase {
  font-size: 1.05rem;
  font-weight: bold;
  color: #f1c40f;
  min-width: 6em;
  text-align: right;
}

/* ビューポート */
.race-anim-viewport {
  position: relative;
  width: 100%;
  height: 300px;
  overflow: hidden;
  border: 3px solid #c9b896;
  border-radius: 6px;
  margin-bottom: 6px;
}
/* 芝コース（デフォルト） */
.race-anim-viewport.course-turf {
  background:
    repeating-linear-gradient(
      -60deg,
      transparent 0px, transparent 14px,
      rgba(255,255,255,0.05) 14px, rgba(255,255,255,0.05) 16px
    ),
    linear-gradient(175deg, #4a9e5c 0%, #3a8a4a 25%, #2d7a3f 55%, #1e6a2a 100%);
}
/* ダートコース */
.race-anim-viewport.course-dirt {
  background:
    repeating-linear-gradient(
      -55deg,
      transparent 0px, transparent 12px,
      rgba(0,0,0,0.06) 12px, rgba(0,0,0,0.06) 14px
    ),
    linear-gradient(175deg, #b8956a 0%, #a07848 25%, #8a6838 55%, #7a5828 100%);
}

/* 柵（レール） ― 上部に余白を設けて少し下に */
.race-anim-fence {
  position: absolute;
  top: 10px; left: 0; right: 0;
  height: 18px;
  border-bottom: 2px solid rgba(255,255,255,0.5);
  z-index: 6;
  overflow: hidden;
}
.race-anim-fence-inner {
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(
    90deg,
    rgba(255,255,255,0.55) 0px, rgba(255,255,255,0.55) 2px,
    transparent 2px, transparent 36px
  );
}

/* 馬 */
.race-anim-horse {
  position: absolute;
  display: flex;
  align-items: center;
  z-index: 3;
  transition: none;
  will-change: left;
}
.race-horse-badge {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  font-weight: bold;
  font-family: "DotGothic16", sans-serif;
  flex-shrink: 0;
  border: 2px solid rgba(255,255,255,0.7);
  box-shadow: 0 2px 6px rgba(0,0,0,0.45);
}
.race-horse-icon {
  font-size: 28px;
  line-height: 1;
  margin-right: -2px;
}

/* ゴール板 ― 柵上のアーチ型ゲート（JRA風） */
.race-anim-goal {
  position: absolute;
  top: 0;
  width: 8px;
  height: 100%;
  z-index: 9;
  pointer-events: none;
}
/* メインの縦柱（赤白ストライプ） */
.goal-post {
  position: absolute;
  top: 0;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 5px;
  background: repeating-linear-gradient(
    180deg,
    #fff 0px, #fff 6px,
    #c0392b 6px, #c0392b 12px
  );
}
/* 上部の横板（ゴール看板） */
.goal-banner {
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  background: #c0392b;
  color: #fff;
  font-size: 0.5rem;
  font-weight: bold;
  letter-spacing: 0.06em;
  padding: 2px 8px;
  white-space: nowrap;
  border: 1px solid #fff;
  border-radius: 0 0 3px 3px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.4);
  z-index: 1;
}

/* 天候エフェクト */
.race-anim-weather {
  position: absolute;
  inset: 0;
  z-index: 7;
  pointer-events: none;
}
.race-anim-weather.weather-cloudy {
  background: rgba(180,180,180,0.15);
}
.race-anim-weather.weather-rain {
  background:
    repeating-linear-gradient(
      100deg,
      transparent 0px, transparent 6px,
      rgba(180,210,240,0.25) 6px, rgba(180,210,240,0.25) 7px
    );
  animation: rain-fall 0.3s linear infinite;
}
@keyframes rain-fall {
  from { background-position: 0 0; }
  to   { background-position: -8px 16px; }
}
.race-anim-weather.weather-heavy-rain {
  background:
    repeating-linear-gradient(
      105deg,
      transparent 0px, transparent 4px,
      rgba(160,190,220,0.35) 4px, rgba(160,190,220,0.35) 5px
    );
  animation: rain-fall 0.2s linear infinite;
}
.race-anim-weather.weather-snow {
  background:
    radial-gradient(1px 1px at 20% 30%, rgba(255,255,255,0.7), transparent),
    radial-gradient(1px 1px at 60% 70%, rgba(255,255,255,0.5), transparent),
    radial-gradient(1px 1px at 80% 20%, rgba(255,255,255,0.6), transparent);
  background-size: 40px 40px;
  animation: snow-fall 1.5s linear infinite;
}
@keyframes snow-fall {
  from { background-position: 0 0; }
  to   { background-position: -10px 40px; }
}

/* 馬券表示（レースアニメ中） */
.race-anim-tickets {
  display: flex;
  flex-wrap: wrap;
  gap: 3px;
  padding: 4px 2px 0;
  max-height: 48px;
  overflow-y: auto;
  font-size: 0.65rem;
  color: #c9b896;
}
.race-anim-ticket-item {
  display: flex;
  align-items: center;
  gap: 3px;
  background: rgba(255,255,255,0.08);
  border-radius: 3px;
  padding: 2px 5px;
  white-space: nowrap;
}
.race-anim-ticket-type {
  font-weight: bold;
  color: #f1c40f;
}

/* 場面転換カット */
.race-anim-scene-cut {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.88);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 20;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.22s ease;
}
.race-anim-scene-cut.active { opacity: 1; }
.race-anim-scene-cut span {
  color: #f1c40f;
  font-size: 1.8rem;
  font-weight: bold;
  text-shadow: 0 0 16px rgba(241,196,15,0.5);
  letter-spacing: 0.1em;
}

/* 順位ボード */
.race-anim-board {
  display: flex;
  gap: 4px;
  justify-content: center;
  align-items: center;
  padding: 6px 2px;
  flex-wrap: wrap;
  min-height: 36px;
}
.race-board-item {
  display: flex;
  align-items: center;
  gap: 2px;
  font-size: 0.85rem;
  color: #c9b896;
}
.race-board-rank {
  font-weight: bold;
  min-width: 16px;
  text-align: right;
}
.race-board-badge {
  width: 26px;
  height: 26px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.8rem;
  font-weight: bold;
  font-family: "DotGothic16", sans-serif;
  border: 1.5px solid rgba(255,255,255,0.5);
}
.race-board-sep {
  width: 1px;
  height: 20px;
  background: rgba(255,255,255,0.2);
  margin: 0 2px;
}

/* ----- 購入済み馬券一覧（レース画面） ----- */
.race-purchased-wrap {
  margin: 8px 0;
  border-top: 2px solid var(--pastel-border);
  padding-top: 4px;
}

.race-purchased-title {
  font-size: 0.85rem;
  margin: 0 0 4px;
}

.race-purchased-title span {
  font-weight: normal;
  font-size: 0.8rem;
  color: var(--pastel-accent);
}

.purchased-empty {
  font-size: 0.8rem;
  color: var(--pastel-accent);
  margin: 4px 0;
}

.purchased-ticket-row {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 0.75rem;
  padding: 3px 4px;
  border-bottom: 1px solid var(--pastel-border);
}

.purchased-type {
  background: var(--pastel-accent);
  color: #fff;
  border-radius: 3px;
  padding: 1px 5px;
  font-weight: bold;
  min-width: 40px;
  text-align: center;
  flex-shrink: 0;
}

.purchased-sel {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.purchased-pts {
  flex-shrink: 0;
  color: var(--pastel-accent);
}

.purchased-yen {
  flex-shrink: 0;
  font-weight: bold;
}

.btn-del-ticket {
  background: #c53030;
  color: #fff;
  border: none;
  border-radius: 3px;
  width: 20px;
  height: 20px;
  font-size: 0.75rem;
  cursor: pointer;
  flex-shrink: 0;
  line-height: 1;
  font-family: "DotGothic16", sans-serif;
}

.btn-del-ticket:hover { background: #e53e3e; }

/* ----- ユーザー馬券内訳（結果画面） ----- */
.user-tickets-wrap {
  margin-bottom: 12px;
}

.user-ticket-empty {
  font-size: 0.85rem;
  color: var(--pastel-accent);
  text-align: center;
}

.user-ticket-row {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 0.75rem;
  padding: 4px 6px;
  border-bottom: 1px solid var(--pastel-border);
  border-radius: 3px;
  margin-bottom: 2px;
}

.user-ticket-hit {
  background: rgba(56, 161, 105, 0.15);
}

.user-ticket-miss {
  background: rgba(200, 200, 200, 0.2);
}

.ut-result {
  font-weight: bold;
  min-width: 36px;
  text-align: center;
  flex-shrink: 0;
}

.user-ticket-hit .ut-result {
  color: #c53030;
}

.user-ticket-miss .ut-result {
  color: #999;
}

.ut-type {
  background: var(--pastel-accent);
  color: #fff;
  border-radius: 3px;
  padding: 1px 5px;
  font-weight: bold;
  min-width: 40px;
  text-align: center;
  flex-shrink: 0;
}

.ut-sel {
  flex: 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.ut-cost {
  flex-shrink: 0;
  font-size: 0.7rem;
  color: var(--pastel-accent);
}

.ut-payout {
  flex-shrink: 0;
  font-weight: bold;
}

.user-ticket-hit .ut-payout {
  color: #c53030;
}

.user-ticket-summary {
  display: flex;
  justify-content: space-around;
  font-size: 0.8rem;
  padding: 6px 4px;
  margin-top: 4px;
  border-top: 2px solid var(--pastel-border);
}

.profit-plus {
  color: #c53030;
  font-weight: bold;
}

.profit-minus {
  color: #2b6cb0;
  font-weight: bold;
}
